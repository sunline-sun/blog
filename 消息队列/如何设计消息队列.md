### 为什么要用消息队列
- 异步
- 解耦，对于有些业务，我们关注的是通知而不是处理，如果不用消息队列而是直接系统调用，就又多了一个系统的依赖关系，并且响应速度和成功与否都会受到依赖系统的影响，这个时候就可以把通知消息扔到消息队列然后就返回成功，谁需要处理消息让他们自己从消息队列里拿就好了，或者消息队列主动推送
- 削峰，因为上下游系统的处理能力是不一样的，比如web请求和数据库，不同系统之间，所以对于一些不是十分重要，或者实时性要求不高的业务，可以放到消息队列里，根据情况去执行
- 最终一致性，消息队列可以通过记录和补偿尽量保证最终一致性，先把数据记录下来，如果失败了，就重试，知道成功为止，本身消息队列也会刷盘保证信息不丢失
- 广播，如果新增加了一个系统，我们需要和新系统对接联调，如果用消息队列，就可以直接扔到消息队列里，新加的系统自己去订阅就好了。

### 实现消息队列大概思路
- 生产者发送消息到broker
- broker发送给consumer
- consumer回复消息确认
- broker删除、备份消息
- 利用RPC将流程串起来，然后考虑RPC的高可用性，尽量做到无状态，方便水平扩展
- 解决消息堆积，什么时候投递消息
- 消息的存储方式，文件存储还是redis还是数据库
- 实现广播功能，维护消息关系，可以用zk保存
- 保证消息的可靠性
- 实现事务消息

### 消息队列的基本功能
- 
